---
title: " "
output:
  html_document:
    css: "theme/yimby_mel.css"
params:
  area: "Small area"
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(message = FALSE, warning = FALSE, error = FALSE, echo = FALSE, dpi = 300,fig.width = 7, fig.height = 4)

# Corrected function to generate a button with customizable text and link
generateButton <- function(text, link) {
  buttonHTML <- paste0('<div class="button-row"><div style="opacity: 1; transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg); transform-style: preserve-3d;" class="button-wrapper"><a href="', link, '" class="button-fullwidth-2 w-inline-block"><div style="width: 0%; height: 2px;" class="bottom-line-2"></div><div style="height: 0%; width: 2px;" class="left-line-2"></div><div style="width: 0%; height: 2px;" class="top-line-2"></div><div style="height: 0%; width: 2px;" class="right-line-2"></div><div style="height: 0%; width: 538.617px;" class="overlay-colr-button-2"></div><div style="color: rgb(0, 0, 0);" class="button-text">', text, '</div></a></div></div>')
  cat(buttonHTML)
}

lga_html <- paste0("https://yimby-mel.s3.ap-southeast-2.amazonaws.com/",str_replace_all(missing_middle_lgas," ","+"),".html")
# Use the function to generate buttons
knitr::opts_chunk$set(message = FALSE, warning = FALSE, error = FALSE, echo = FALSE, dpi = 300, fig.width = 7, fig.height = 4)

```


![](atlas/mel_missing_middle.png)

Melbourne is missing desperately needed homes in its middle suburbs, where 
there people want to live near public transport, jobs, and their existing communities. 
The current Government
approach of focusing on a small number of activity
centres —while a step in the right direction— ignores most of the other 1,992 train stations
and tram stops where Melbournians already want to live. 

Melbourne needs a gentle-density, with human scaled homes where people want to live. 

YIMBY Melbourne's [Missing Middle](https://assets-global.website-files.com/64a530aa67ffbab04c9c39ab/652284ad6a63b8b3ab424966_Missing-Middle-Report.pdf) report recommends a better Melbourne, including:

## Missing Middle zoning

![NOTE: placeholder image. We should aim for a wider image that shows a stylised 500m line around a train station. Next to the train station are parks, schools and 6 storey buildings. The buildings have no set-backs from the street, but there is lots of greenery through street trees and nature strips. The image should feel like Melbourne as much as possible - e.g. a METRO train, and with nightingale style apartments.](atlas/mm housing.jpeg)

Melbourne's Missing Middle Zone will enable 6 storey (21 meters) buildings near every train station and tram stop in Melbourne. 
This zone will support a European density, with beautiful street walls without setbacks activating the street below. 

Buildings in Missing Middle zones can include neighbourhood services and amenities like cafes and shops. There are no parking minimums in this zone. 

Developments that serve the community by providing at least 10% public and community housing in this zone are exempt from public notice requirements. 

## Allowing more choice across Melbourne


![NOTE: placeholder image. Needs to be same style image but with buildings we would typically see in GRZ now - 3 storeys tall with lots of on-site gardens, trees etc in a way that blends in to existing deatched homes on the same street.](atlas/mm housing.jpeg)
Not all of Melbourne's suburbs have access to rail but many still benefit from 
nearby schools, hospitals and bus routes. Local communities and businesses that aren’t as
closely situated to Melbourne’s vast train and
tram networks also deserve to reap the benefits
of urban agglomeration.

Inspired by the success of Auckland’s up-zoning reforms, YIMBY Melbourne
endorses a complete elimination of the
current NRZ across Metropolitan Melbourne,
and its replacement with the General Residential Zone (GRZ). In turn, all land currently zoned
GRZ should also be upzoned to the Residential
Growth Zone (RGZ)


## Fair targets for housing abundance {.tabset}

[Victoria's housing statement](https://content.vic.gov.au/sites/default/files/2023-09/DTP0424_Housing_Statement_v6_FA_WEB.pdf) sets out a target for 80,000 new homes every year in Melbourne, with local government targets for where those homes should be built. 

With Melbourne's Missing Middle Zoning, homes can be built near public transport, where people want to live.

YIMBY Melbourne has calculated where there is both demand and land available for missing middle housing to create evidence based Local Government targets for housing each year. 

These targets are in addition to housing built through greenfield development and rezoning such as in Fisherman's Bend or in the Suburban Rail Loop Precincts. 

We want to make Melbourne better. That's why Missing Middle zoning will allow more Melbournians to live near their job, family, friends, and public transport.


### Map

```{r,fig.height=7,fig.width = 8}

state_total = 80000*.7

zoning_numbers <- df_mel_props %>% 
  filter(lga_name_2022 %in% missing_middle_lgas) %>% 
  group_by(lga_name_2022) %>% 
  
  summarise(profitable_apartments = sum(profitable_apartments,na.rm = TRUE),
            existing_dwellings = sum(dwellings_est,na.rm = TRUE)) %>% 
  mutate(`Yearly new home target (share of state total)` = pmax(profitable_apartments - existing_dwellings,0)/sum(profitable_apartments),
         `Yearly new home target` = state_total*`Yearly new home target (share of state total)`,
         `Share of Melbourne's existing homes`     = existing_dwellings /sum(existing_dwellings),
          ) %>% 
  filter(profitable_apartments>2000) %>% 
  select(-profitable_apartments,-existing_dwellings) %>% 
  arrange(desc( `Share of Melbourne's existing homes`))

map_data <- strayr::read_absmap("lga2022") %>% 
  filter(state_name_2021 == "Victoria") %>% 
    mutate(lga_name_2022 = str_remove_all(lga_name_2022, "\\s*\\(.*?\\)\\s*")) %>% 
  inner_join(zoning_numbers) 

#devtools::install_github("yutannihilation/ggsflabel")
map_data%>% 
  mutate(target = paste0(lga_name_2022,"\n",
                         prettyNum(round(`Yearly new home target`,-2),
                                   big.mark = ","),
                         " homes")
         ) %>% 
  ggplot()+
  geom_sf(colour = yimby_colours$green_palette[4])+
  ggthemes::theme_map()+
  ggsflabel::geom_sf_label_repel(aes(label = target ),
                                 size = 2,
                                 fill = yimby_colours$background)+
    labs(title = "Missing Middle Melbourne yearly housing targets",
         x = element_blank(),
         y = element_blank())+
  theme_yimby_mel_caption(text_size = "small",plot_type = "map")+
  theme(panel.background = element_rect(fill= yimby_colours$background))+
    theme(plot.margin = margin(2, 15,2, 15))


```

### Detailed information for planners

Beautifully planned cities like Paris have a built form that 
is predominantly medium-rise and close to public transport,
under a planning
system that enables a high level of site coverage
due to an absence of setback requirements.
The land use patterns seen in Paris — ground
floor commercial and retail spaces, internal
courtyards, and large public enclosed squares
and parks — are largely absent from Melbourne.
There are pockets of this sort of development in
the inner-city, but they are few and far between.
All this is to say: Melbourne’s middle is missing,
because it is broadly banned from being built.

Councils should have housing targets to reflect the medium-rise gentle-density that would
make Melbourne a better place to live. 

But there is no use having a housing target if there is no land to build on, 
or if there is nobody wants to live in these homes. YIMBY Melbourne has therefore carefully calculated
the capacity of each Local Government Area to deliver Missing Middle Housing, 
using a precise 5 stage methodology: 

1) Sites that are parks, schools, hospitals or already have apartments are considered ineligible for any Missing Middle housing
2) Any lot suitable for development within 500m of a train station or tram stop is zoned "Missing Middle" and considered suitable for 6 storeys of housing with high lot coverage. 
3) Other lots are rezoned to Residential Growth, to allow a smaller increase in density.
3) For each lot, the value of land as well as construction costs and demand for apartments in that area are used to calculate whether new homes are potentially viable on that site
4) Each viable site contributes to that state's housing targets, with each council responsible for its share of the state's target based on how many homes are built 

```{r}

dwellings_by_type <- df_mel_props %>%
  group_by(category) %>% 
  summarise(n = n(),
            lot_size = sum(lot_size),
            .groups = "drop") %>% 
  group_by(category) %>% 
  mutate(n_total = sum(n),
         lot_size_total = sum(lot_size))  %>% 
  ungroup() %>%
  mutate(zone_type = "Existing zoning")

dwellings_by_mm_type <- df_mel_props %>%
  group_by(category_new) %>% 
  summarise(n = n(),
            lot_size = sum(lot_size),
            .groups = "drop") %>% 
  group_by(category_new) %>% 
  mutate(n_total = sum(n),
         lot_size_total = sum(lot_size))  %>% 
  ungroup() %>%
  mutate(zone_type = "YIMBY Melbourne Zoning") %>%
  rename(category = category_new)

library(scales)

dwellings_by_type %>% 
  bind_rows(dwellings_by_mm_type) %>% 
  ungroup() %>%
    mutate(category = fct_relevel(category,"Low density residential")) %>% 
  filter(!(category %in% c("Housing not permitted","Civic use makes development less likely","Already developed"))) %>% 
  ggplot(aes(x = category, 
             y = n))+
  coord_flip()+ 
  geom_bar(stat = "identity")+
  theme_yimby_mel_caption(text_size = "small",plot_type = "bar",colour_scale = "light_dark") +
  labs(x = element_blank(),
       title = paste0("Building heights on Melbourne's residential properties"),
       y = "Number of properties",
       fill = "Heritage status") +
  facet_wrap(~zone_type) +
  scale_y_continuous(labels = scales::number_format(scale_cut = cut_short_scale()))

```

Where there is considerable demand for more housing in an area, and there is land to enable it, councils should have clear targets to meet their density goals. 
Councils that move first will have an advantage, because they'll be approving apartments when demand is highest and there is less competition from other council areas. 

Heritage overlays over large swathes of our inner-suburbs should not be an excuse for councils to miss their housing targets. Councils with considerable heritage in missing middle zones will need to consider how to best achieve their targets whilst maintaining the heritage that is most important to them. 

Councils should be given the ability to quickly re-evaluate heritage overlays and Design and Development overlays if they are unable to meet housing targets within current overlays. 

By providing more diverse and dense housing
across Melbourne, more people will be able to
live both near their work and within their communities. These housing options will enable
children to remain near their parents when they
move out, and enable international and interstate migrants to  live near their existing com-
munity networks.

The best way for a Local Government Area to reduce its target is to make housing cheaper. 
Melbourne's Missing Middle targets should be updated by government every year, 
and if townhouse or apartment prices
fall relative to other areas, then the housing target will auomatically fall as it will become clear that development is no longer profitable in that area.  

```{r}

table_data <- df_mel_props %>% 
  filter(!feature_preventing_development,
         zoning_permits_housing == "Housing permitted",
         dwellings_est < 2) %>% 
filter(profit>0) %>% 
mutate(net_profitable_apartments = pmax(0,profitable_apartments - dwellings_est)) %>% 
group_by(lga_name_2022) %>% 
summarise(buxton_yield  =sum(buxton_yield_net),
          mm_yield_net = sum(mm_yield_net),
          mm_profitable_yield = sum(net_profitable_apartments) / sum(mm_yield_net)) %>% 
  left_join(zoning_numbers) %>% 
  mutate(`share of 'zoned capacity' to be built each year` = mm_profitable_yield/mm_yield_net) %>% 
  rename(`Current estimated 'zoned capacity' of land` = buxton_yield,
         `New estimated zoned capacity` = mm_yield_net,
         `Share of new zoned capacity estimated to be viable for development` = mm_profitable_yield) 


table_data %>% 
  mutate(across(where(is.numeric), ~case_when(.x <.01 ~paste0(round(100*.x,3),"%"),
                                               .x <1 ~paste0(round(100*.x,1),"%"),
                                              T ~ prettyNum(round(.x,-1),big.mark = ",")))
  ) %>% 
  relocate(`Share of Melbourne's existing homes`) %>% 
    relocate(`Yearly new home target (share of state total)`,.after = `Yearly new home target`) %>% 
      relocate(lga_name_2022) %>% 
  rename(` ` = lga_name_2022) %>% 
  gt() %>% 
tab_options(
    table.background.color = yimby_colours$background# Change "lightblue" to any color you prefer
  )
```



## Melbourne is failing to deliver its Missing Middle

With the exception of Melbourne, most middle ring councils in Melbourne are not doing enough to house Melbourne's future population, 
pushing more people out onto our urban fringe. 


```{r fig.height = 8}

pop_change_by_lga <-lga_pop_change_importer(lgas) %>% 
  filter(year == 2022)

pop_change_by_lga %>% 
  mutate(type = if_else(lga_name_2021 == "All of Melbourne","y","n")) %>% 
  ungroup() %>% 
  mutate(change = change - 1, 
         lga_name_2021 = fct_reorder(lga_name_2021,change)) %>% 
  ggplot(aes(x = lga_name_2021, 
             y = change,
             fill = type))+
  geom_bar(stat = "identity")+
  coord_flip()+
  theme_yimby_mel_caption("source: ABS regional populations",text_size = "small")+
  labs(title = "Middle and inner-suburban suburbs are not keeping up with\nMelbourne's need for more housing",
       subtitle = "Population change 2014-2022 (%)",
       y = element_blank(),
       x = element_blank())+
  scale_y_continuous(labels = percent_format(accuracy = 1))+
  theme(legend.position = "none")+
  geom_hline(yintercept = 0)
```

## Housing targets need to be real

There's currently no mechanism to ensure that Local Government Area housing plans have teeth.
The government should follow Infrastructure Victoria and Productivity Commission recommendations to
attach carrots and sticks to housing targets. 

** insert detail on carrots and sticks **

## YIMBY Melbourne's plan for missing middle in your area

```{r results='asis'}
cat('<div class="button-row">')
walk2(missing_middle_lgas,lga_html,generateButton)
cat('</div>')
```





