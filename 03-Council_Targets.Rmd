# Housing targets 2024-25

```{r}
tbl_body  <- lga_zoning_numbers %>% 
  select(`Council` = lga_name_2022,
         `Current zoned capacity` = zoned_capacity,
         #`(Excluding heritage)` = zoned_capacity_heritage,
         `New zoned capacity under Missing Middle` = mm_zoned_capacity,
         `Increase in zoned capacity` = change_to_zoned_capacity,
         `Yearly housing target` = mm_target) %>% 
  arrange(desc(`Increase in zoned capacity` ))

total = tbl_body %>% 
  summarise(`Current zoned capacity` = sum(`Current zoned capacity`),
            `New zoned capacity under Missing Middle` = sum(`New zoned capacity under Missing Middle`),
            `Yearly housing target` = sum(`Yearly housing target`)) %>% 
  mutate(`Increase in zoned capacity` = `New zoned capacity under Missing Middle`/`Current zoned capacity`,
         `Council` = "Total")

# tbl_body %>%
#  mutate( `Increase in zoned capacity` = paste0(round(`Increase in zoned capacity`,1),"x")) %>% 
#  gt() %>% 
#  fmt_number(c(`Current zoned capacity`,
#               `New zoned capacity under Missing Middle`),n_sigfig = 3) %>% 
#  summary_rows(total) %>%
#tab_options(
#    table.background.color = yimby_colours$background, # Change "lightblue" to any color you prefer
#    table.align = "right",
#    ihtml.active = TRUE,
#    ihtml.use_sorting = TRUE,
#    ihtml.use_pagination = FALSE,
#    ihtml.use_pagination_info = FALSE,
#  ) %>% 
#    tab_style(
#    style = list(
#      cell_text(weight = "bold")
#    ),
#    locations = cells_body(
#      rows = everything() %>% tail(1)
#    )
#  )
```

```{r}

# TODO: format the numbers please

total = tbl_body %>% 
  summarise(`Current zoned capacity` = sum(`Current zoned capacity`),
            `New zoned capacity under Missing Middle` = sum(`New zoned capacity under Missing Middle`),
            `Yearly housing target` = sum(`Yearly housing target`)
            ) %>% 
  mutate(`Increase in zoned capacity` = paste0(round(`New zoned capacity under Missing Middle`/`Current zoned capacity`,1),"x"),
         `Council` = "Total") %>% 
  mutate(`Current zoned capacity`  = prettyNum(round(`Current zoned capacity`,-3),big.mark = ","),
         `New zoned capacity under Missing Middle`  = prettyNum(round(`New zoned capacity under Missing Middle`,-3),big.mark = ","),
         `Yearly housing target` = prettyNum(round(`Yearly housing target`,-2),big.mark = ","),
         )

test_footer <- matrix(0, nrow=1, ncol=5)
colnames(test_footer) <- c('Total', total[1, 1], total[1, 2], total[1, 4],total[1, 3])

summary_table = htmltools::withTags(table(
  id="summary-table",
  tableHeader(tbl_body),
  tableFooter(test_footer)
))


tbl_body %>% 
  mutate(across(c(`Current zoned capacity`,`New zoned capacity under Missing Middle`),~round(.x,-3)),
across(c(`Yearly housing target`),~round(.x,-2))) %>%
datatable(
  container = summary_table,
  options = list(dom = 't',
                 pageLength = 20
                 ),
  rownames = FALSE
) %>% 
  formatRound(columns = c(2,3,5), mark = ',',digits = 0) %>% 
  formatCurrency(columns = c(4), digits = 1,currency = "x", before = F)

```