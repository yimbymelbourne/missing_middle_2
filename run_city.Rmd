---
title: " "
output:
  html_document:
    css: "theme/yimby_mel.css"
params:
  area: "Small area"
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(message = FALSE, warning = FALSE, error = FALSE, echo = FALSE, dpi = 300,fig.width = 7, fig.height = 4)

parcels <- prettyNum(nrow(df_lga_props),big.mark = ",")

fois <- df_lga_props %>% 
  filter(feature_preventing_development) %>% 
  nrow()%>% 
  prettyNum(big.mark = ",")
  
bad_zoning <- df_lga_props %>% 
    filter(!feature_preventing_development) %>% 
  group_by(zoning_permits_housing) %>% 
  summarise(n=n()) %>% 
  filter(zoning_permits_housing == "Housing not generally permitted") %>% 
  pull(n) %>% 
  prettyNum(big.mark = ",")

already_developed <- df_lga_props %>% 
  filter(zoning_permits_housing == "Housing permitted",
         !feature_preventing_development,
         dwellings_est>1) %>%
  nrow()%>% 
  prettyNum(big.mark = ",")


df_lga_useful_props_num <-  prettyNum(nrow(df_lga_useful_props),big.mark = ",")

mcg_size <- 20000 

```

![](atlas/mel_missing_middle.png)

##  {.tabset}


Melbourne’s middle urban areas are broadly
underutilised, and the current Governmental
approach of focusing on a small number of activ-
ity centres—while a step in the right direction—
has been slow to roll out, and ignores large
swathes of our urban landscape that would
strongly benefit from enabling medium density.

The answer to the housing supply shortage,
therefore, will not be found in this handful of
designated activity centres and precincts.
Rather, it will be found through the delivery of
permissive planning reforms across every one
of Metropolitan Melbourne’s existing 1,992 train
and tram stops.

Melbourne’s existing rail network provides fre-
quent, high capacity transport options across
the whole city, and by building near these sta-
tions, we give more people access to this net-
work, while simultaneously providing more
destinations that are close to rail.

Through broad transit-oriented upzoning and
development, the Victorian Government can
deliver housing abundance and provide more
housing choices to all current and future resi-
dents across the entirety of the city. This will
fulfil the original goal of Plan Melbourne creat-
ing a vast array of 20-minute neighbourhoods,
rather than a small number of scattered activ-
ity centres.

YIMBY Melbourne's [Missing Middle](https://assets-global.website-files.com/64a530aa67ffbab04c9c39ab/652284ad6a63b8b3ab424966_Missing-Middle-Report.pdf) report recommendeds the introduction
of a new "Missing Middle" Zone which:

1. Implements a default maximum height of
21 metres and 6 storeys, an increase from
the RGZ’s current 4-storey default.
2. Expands non-residential land uses to
include a wider range of neighbourhood
services & amenities.
3. Reduces mandatory parking minimums to 0.
4. Exempts from notice and review develop-
ments of any total value containing at
least 10% public or community housing
in perpetuity.


```{r }


mm_number <- df_lga_useful_props %>% filter(zone_short_mm == "Missing middle") %>% nrow() %>% prettyNum(big.mark = ",")

```

In `r area_name`, `r mm_number` properties would be up-zoned to missing middle, providing a Parisian like density near transit in `r area_name`. 

While this report focuses on the provision of
the Missing Middle Zone around existing transit
infrastructure, the Government must in addi-
tion to this undertake broad upzoning to enable
more development in existing suburbs.
While the MMZ enables a thriving Parisian-style
density for Melbourne, broader upzoning of all
land currently designated Neighbourhood Resi-
dential Zone (NRZ) or equivalent will encourage
a more diverse array of housing options across
the city through an increase in gentle density.

YIMBY Mel-bourne endorses a complete elimination of the
current NRZ across Metropolitan Melbourne,
and its replacement with the General Residen-
tial Zone (GRZ). In turn, all land currently zoned
GRZ should also be upzoned to the Residential
Growth Zone (RGZ).

### Missing middle's new zoning map


```{r}
make_map(sf_lga_props,"category_new")

```




### Existing zoning
```{r}
make_map(sf_lga_props,"category")

```





## Our plan will 4/5/6/7x `r params$area`'s zoned capacity to deliver more housing 

Todo - figure out current zoned capacity and then figure out how much we are icnreasing it. 

## Housing targets for `r params$area` 

should have x% of Melbourne's housing as a target. 

With current state target that means xyz homes per year over the next 10 years. 


## Without missing middle `r params$area` is falling behind




```{r}

#source("R/import_lga_pop_data.R")

mel_total <- lga_pop_change_importer(area_name, type = "density")


lga_change <- mel_total %>% 
  filter(year == 2021,
         lga_name_2021 == area_name) %>%
  pull(change)

mel_change <- mel_total %>% 
  filter(year == 2021,
         lga_name_2021 == "All of Melbourne") %>%
  pull(change)


  
change_ratio <- lga_change/mel_change

## TODO - get PT stops per LGA. 

text_on_growth <- case_when(change_ratio >.9 ~ paste0(params$area, " has been building housing, but cannot rest on its laurels"),
                            change_ratio >.7 ~ paste0(params$area, " has been building some housing, but it is still barely keeping up with the average for Melbourne."),
                            T ~ paste0(params$area, " is falling well behind the average for new housing in Melbourne.")
)

```


`r text_on_growth` params$area has amazing public transport, and it needs to do more to ensure that housing is abundant. 

```{r}
mel_total %>%
  ggplot(aes( x= year, y = change,
              colour = lga_name_2021))+
  geom_line(stat = "identity",linewidth = 1)+
  theme_yimby_mel_caption(caption = "source: ABS. ",
                          text_size = "small",
                          plot_type = "line",
                          colour_scale = "c")+
  labs(title = paste("Growth in homes for",area_name,"compared to the rest of Melbourne"),
       subtitle = "Growth in census dwellings since 2006",
       labs = element_blank(),
       colour = "Area",
       x = element_blank(),
       y = element_blank())+
  scale_y_continuous(labels = scales::percent_format())


```



## `r area_name` is falling behind because not enough of the area is zoned for more housing. {.tabset}

Not enough housing is being built in `r area_name` because it has not been zoned for housing. 

### By number of lots

```{r}

dwellings_by_type <- df_lga_useful_props %>%
  group_by(category) %>% 
  summarise(n = n(),
            lot_size = sum(lot_size),
            .groups = "drop") %>% 
  group_by(category) %>% 
  mutate(n_total = sum(n),
         lot_size_total = sum(lot_size))  %>% 
  ungroup() 

dwellings_by_type %>% 
  mutate(category = fct_reorder(category,n_total)) %>% 
  ggplot(aes(x = category, 
             y = n))+
  coord_flip()+ 
  geom_bar(stat = "identity")+
  theme_yimby_mel_caption(text_size = "small",plot_type = "bar",colour_scale = "light_dark") +
  labs(x = element_blank(),
       title = paste0("Land in ",area_name," by type"),
       y = "Number of properties",
       fill = "Heritage status")

```

### By total area

```{r by total area}
dwellings_by_type %>% 
    mutate(category = fct_reorder(category,lot_size_total)) %>%
  ggplot(aes(x = category, 
             y = lot_size_total))+
  coord_flip()+ 
  geom_bar(stat = "identity")+
  theme_yimby_mel_caption(text_size = "small",plot_type = "bar",colour_scale = "light_dark") +
  labs(x = element_blank(),
       title = paste0("Land in ",area_name," by type"),
       y = "Area (sqm)",
       fill = "Heritage status")+
  scale_y_continuous(labels = scales::number_format(big.mark = ","))

```

### Table


```{r}
library(kableExtra)
library(gt)

dwellings_by_type_w_heritage <- df_lga_useful_props %>%
  group_by(category,heritage) %>% 
  summarise(n = n(),
            lot_size = sum(lot_size),
            .groups = "drop") %>% 
  group_by(category) %>% 
  mutate(n_total = sum(n),
         lot_size_total = sum(lot_size))  %>% 
  ungroup() %>% 
  mutate(heritage = if_else(heritage,
                            "Subject to heritage controls",
                            "Free from heritage"))

types_zonning <- df_lga_useful_props %>% 
  group_by(heritage) %>% 
  summarise(n = n(),
            lot_size = sum(lot_size)) %>% 
  mutate(category = "Total")%>% 
  mutate(heritage = if_else(heritage,
                            "Subject to heritage controls",
                            "Free from heritage"))


types_total_new <- df_lga_useful_props %>%
  filter(!feature_preventing_development,
         zoning_permits_housing == "Housing permitted",
         dwellings_est < 2) %>% 
  group_by(heritage) %>% 
  summarise(n = n(),
            lot_size = sum(lot_size),
            .groups = "drop") %>% 
  mutate(heritage = if_else(heritage,
                            "Subject to heritage controls",
                            "Free from heritage"),
         category = "Total where new housing can be built") 

dwellings_by_type_w_heritage %>% 
  bind_rows(types_zonning) %>% 
  bind_rows(types_total_new) %>% 
  group_by(category) %>% 
  mutate(`Share of properties that are heritage` = paste0(round(100*n/sum(n)),"%"),
         `Share of land that is heritage` =  paste0(round(100*lot_size/sum(lot_size)),"%")
         ) %>% 
  rename(`Number of properties` = n,
         `Area (sqm)` = lot_size,
         ` ` = heritage) %>% 
  select(-n_total,-lot_size_total) %>% 
    gt()  %>% 
  fmt_number(decimals = 0)

  

```




Housing is falling behind because nothing gets built in NRZ/GRZ. 

insert building approval data for this LGA by zone category


## Heritage should not be a barrier to housing abudance 



```{r conditional-include, echo=FALSE, results='asis'}

# Conditionally include the R Markdown file
if(area_name == "Melbourne") {
  
  original_wd <- getwd()
  res <-knitr::knit_child('R/mel_specific_render.Rmd', quiet = TRUE,options  = c("root.dir" = original_wd))
  cat(res)
  


}

```

## Lot sizes are no barrier to growth

This LGA has big lots, but we can build on small lots anyway. 

## Lot sizes in Yarra {.tabset}

Larger lots can be easier to develop, but Melbourne has been sucssessful in developing even on small lots

### By number of lots

```{r cars}


df_lga_props %>%
  ggplot() + 
  geom_density_ridges(aes(x = lot_size, 
                     fill = heritage_nice,
                     group = paste0(type_short,heritage),
                     y = type_short,
                     weight = lot_size
                     ),
                     alpha = .8) +
  xlim(0,2000)+
  theme_yimby_mel_caption(text_size = "small",plot_type = "bar",colour_scale = "light_dark") +
  labs(title = paste0("Land in ",params$area," by size of each lot"),
       subtitle = "Height represents the number of lots of each size",
       fill = "Heritage",
      x = "Size of individual lots",
      y = element_blank())

```

### By area

```{r }

 df_lga_props[rep(seq_along(round(as.numeric(df_lga_props$lot_size/50))), round(as.numeric(df_lga_props$lot_size/50))), ] %>%
  mutate(group_name = paste0(type_short,heritage)) %>%
  ggplot() + 
  geom_density_ridges(aes(x = lot_size, 
                     fill = heritage_nice,
                     group = group_name,
                     y = type_short,
                     ),
                     alpha = .8) +
  xlim(0,2000) +
  theme_yimby_mel_caption(text_size = "small",
                          plot_type = "bar",
                          colour_scale = "light_dark") +
  labs(title = paste0("Land in ",params$area," by size of each lot"),
      subtitle = "Height represents the total area taken up by lots of a given lot size",
       fill = "Heritage",
      x = "Size of individual lots",
      y = element_blank())


```

## Why missing middle will make housing better in Melbourne

Recycle text from missing middle report. 

## Appendix A: `r params$area` land profile in ? 

There are `r parcels` parcels of land in `r params$area`. But not every piece of land can have housing on it. Of these parcels, `r fois` are on civic land like schools, hospitals, or train stations where development is challenging. Another `r bad_zoning` are in zones that do not development. Finally `r already_developed` properties have already been developed with more than 1 unit, making re-development difficult. 

That leaves `r df_lga_useful_props_num` that are available for development. The size of these lots is `r prettyNum(sum(df_lga_useful_props$lot_size),big.mark = ",")` square meters, or `r round(as.numeric(sum(df_lga_useful_props$lot_size))/mcg_size)` MCGs worth of space to build housing. 